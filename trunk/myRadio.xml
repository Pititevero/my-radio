<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="myRadio"
               author="myRadio team"
               height="800"
               scrolling="true" />
  <Content type="html">
  <![CDATA[
    <div id="debug-msg"></div>

    <button onclick="updateRadioList();">update</button>

    <select id="radio-list" onchange="changeStation(this);"></select>

    <iframe id="gadget" src=""></iframe>


    <script type="text/javascript">
      var radioList = _gel('radio-list');

      function updateRadioList() {
        getRadioGadgets(console.log, appendGadget);
      }

      function isFeed(item) {
        return item['ghapi:type'] == 'feed';
      }

      function appendGadget(gadgetItem) {
        if (!isFeed(gadgetItem)) {
          var elem = createOptionElement(gadgetItem);
          radioList.appendChild(elem);
        }
      }

      function createOptionElement(gadgetItem) {
        var element = document.createElement('option');

        element.setAttribute('value', gadgetItem.guid);
        element.appendChild(document.createTextNode(gadgetItem.title));

        return element;
      }

      function showRadio(stationUrl) {
        _gel('gadget').setAttribute('src', createEmbedGadgetUrl(stationUrl));
      }

      function changeStation(select) {
        var item = select[select.selectedIndex];
        var station = item.value;
        showRadio(station);
      }
    </script>
    <script src="http://my-radio.googlecode.com/svn/trunk/js/directory-search.js"></script>
    <script src="http://my-radio.googlecode.com/svn/trunk/js/my-radio.js"></script>
    ]]>
  </Content>
</Module>

