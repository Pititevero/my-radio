<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="myRadio"
               author="myRadio team"
               height="800"
               scrolling="true" />
  <Content type="html">
  <![CDATA[
    <label>
      Select station:
      <select id="radio-list" onchange="changeStation(this);"></select>
    </label>

    <iframe id="gadget" src="" style="width: 100%;"></iframe>


    <script type="text/javascript">
      var radioList = _gel('radio-list');

      function doNothing() { console.log('doing nothing'); }

      function updateRadioList() {
        getRadioGadgets(doNothing, appendGadget);
      }

      function appendGadget(gadgetItem) {
        console.debug('got item', gadgetItem);
        if (!isFeed(gadgetItem)) {
          var elem = createOptionElement(gadgetItem);
          radioList.appendChild(elem);
        }
      }

      function createOptionElement(gadgetItem) {
        var element = document.createElement('option');

        element.setAttribute('value', gadgetItem.guid);
        element.appendChild(document.createTextNode(gadgetItem.title));

        return element;
      }

      function showRadio(stationUrl) {
        _gel('gadget').setAttribute('src', createEmbedGadgetUrl(stationUrl));
      }

      function changeStation(select) {
        var item = select[select.selectedIndex];
        var station = item.value;
        showRadio(station);
      }
    </script>
    <script src="http://my-radio.googlecode.com/svn/trunk/js/directory-search.js"></script>
    <script src="http://my-radio.googlecode.com/svn/trunk/js/my-radio.js"></script>
    ]]>
  </Content>
</Module>

